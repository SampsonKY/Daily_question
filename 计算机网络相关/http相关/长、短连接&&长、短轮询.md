## 长连接 && 短连接

HTTP长连接（long connection）与短连接（short connection）

- 本质上是TCP长连接和短连接：
- **短连接是指在一次HTTP请求和响应之后立即关闭本次TCP连接，下次请求响应重建一个新的TCP连接**；
- 而**长连接是指请求响应之后并不立即关闭本次TCP连接，下次请求响应继续重用该TCP连接**。
- HTTP/1.0默认短连接，HTTP/1.1起默认长连接
- 长连接通过请求头**Connection: keep-alive**启用长连接、通过**Keep-Alive: timeout=20**设置长连接的超时时间（秒），超时后关闭该TCP连接

## 长轮询 && 短轮询

- **HTTP长轮询**（long polling）是指服务端收到请求后若**有数据立即返回，若无数据则保持到有数据或一段时间后超时**，浏览器收到响应后**立即重新发送相同的请求**；
- **HTTP短轮询**（short polling）是指服务端收到请求后**无论是否有数据都立即返回**，浏览器收到响应后**间隔一段自定义时间后重新发送相同的HTTP请求**。
- 轮询建立在连接基础上，轮询是长是短与连接是长是短无关。
- **共同点**：都是基于HTTP连接，都将重复发送相同请求。
- **长轮询**：获取数据比较实时，服务器端需要较多资源以维持众多长轮询。
- **短轮询**：获取数据不实时，通过浏览器端脚本即可实现。

HTTP长轮询主要用于实现需要实时获取数据的地方，例如：即时消息、实时股票价格等，其主要技术要点在于服务端无数据时如何保持到有数据或超时。另外在请求发生频率上，长轮询也可以在入短连接一样收到响应后间隔一段时间后才发送，只是会不够实时；短轮询也可以如长连接一样在收到响应后立即发送，只是会给服务器端造成过大压力。

总而言之，实现长轮询需在**服务器端异步**的基础上，使用如下等方式检测是否有新数据：

（1）死循环检测，需设置死循环自动退出条件，并且需要配合线程休眠；

（2）计时器定时检测，需设置计时器自动停止条件；

（3）发布订阅方式，增删改数据之处发布消息，检测新数据之处订阅该消息；

（4）锁方式，若无新数据获取锁失败，有新数据时获取锁成功；

（5）其它能实现线程阻塞的方式。